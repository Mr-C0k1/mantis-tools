import requests
from urllib.parse import urljoin

class MantisExploit:
    def __init__(self, target_ip, open_ports):
        self.target_ip = target_ip
        self.open_ports = open_ports
        self.found_vulns = []

    def check_exposure(self, base_url, file_path, vuln_type):
        url = urljoin(base_url, file_path)
        try:
            resp = requests.get(url, timeout=5, allow_redirects=False)
            if resp.status_code == 200:
                self.found_vulns.append({"type": vuln_type, "url": url, "severity": "CRITICAL"})
                return True
        except: pass
        return False

    def start(self):
        web_ports = [p for p in self.open_ports if p in [80, 443, 8080]]
        for port in web_ports:
            schema = "https" if port == 443 else "http"
            base_url = f"{schema}://{self.target_ip}:{port}/"
            self.check_exposure(base_url, ".env", ".env Exposure")
            self.check_exposure(base_url, ".git/HEAD", "Git Exposure")
        return self.found_vulns
